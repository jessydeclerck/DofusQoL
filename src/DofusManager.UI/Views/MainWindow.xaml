<Window x:Class="DofusManager.UI.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:controls="clr-namespace:DofusManager.UI.Controls"
        Title="DofusManager" Height="620" Width="780"
        WindowStartupLocation="CenterScreen"
        Topmost="{Binding IsTopmost}">

    <DockPanel>
        <!-- StatusBar en bas -->
        <StatusBar DockPanel.Dock="Bottom">
            <StatusBarItem Content="{Binding StatusText}" />
        </StatusBar>

        <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="10">
            <StackPanel>

                <!-- ===== PERSONNAGES ===== -->
                <GroupBox Header="Personnages" Margin="0,0,0,8">
                    <StackPanel>
                        <!-- Boutons Polling/Hotkeys + Topmost -->
                        <StackPanel Orientation="Horizontal" Margin="5,5,5,5">
                            <Button Content="{Binding PollingButtonText}"
                                    Command="{Binding TogglePollingCommand}"
                                    Padding="8,3" Margin="0,0,5,0" />
                            <Button Content="Rafraîchir"
                                    Command="{Binding RefreshCommand}"
                                    Padding="8,3" Margin="0,0,10,0" />
                            <Button Content="{Binding HotkeysButtonText}"
                                    Command="{Binding ToggleHotkeysCommand}"
                                    Padding="8,3" Margin="0,0,15,0" />
                            <CheckBox Content="Toujours visible"
                                      IsChecked="{Binding IsTopmost}"
                                      VerticalAlignment="Center" />
                        </StackPanel>

                        <!-- En-tête colonnes -->
                        <Grid Margin="5,2,5,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="50" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="140" />
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0" Text="Leader" FontWeight="SemiBold" Foreground="Gray" Margin="4,0,0,0" />
                            <TextBlock Grid.Column="1" Text="Personnage" FontWeight="SemiBold" Foreground="Gray" Margin="8,0,0,0" />
                            <TextBlock Grid.Column="2" Text="Raccourci" FontWeight="SemiBold" Foreground="Gray" Margin="4,0,0,0" />
                        </Grid>

                        <!-- Liste des personnages (drag-and-drop pour réordonner) -->
                        <ListBox ItemsSource="{Binding Characters}" Margin="5,0,5,5"
                                 HorizontalContentAlignment="Stretch"
                                 controls:DragDropReorderBehavior.IsEnabled="True"
                                 BorderThickness="0" Background="Transparent">
                            <ListBox.ItemContainerStyle>
                                <Style TargetType="ListBoxItem">
                                    <Setter Property="Padding" Value="0" />
                                    <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                                    <Setter Property="Cursor" Value="SizeAll" />
                                </Style>
                            </ListBox.ItemContainerStyle>
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <Grid Margin="0,1">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="50" />  <!-- Leader -->
                                            <ColumnDefinition Width="*" />   <!-- Nom -->
                                            <ColumnDefinition Width="140" /> <!-- Raccourci -->
                                        </Grid.ColumnDefinitions>

                                        <!-- Checkbox Leader -->
                                        <CheckBox Grid.Column="0" IsChecked="{Binding IsLeader, Mode=OneWay}"
                                                  VerticalAlignment="Center" Margin="4,0,0,0">
                                            <CheckBox.InputBindings>
                                                <MouseBinding MouseAction="LeftClick"
                                                    Command="{Binding DataContext.ToggleLeaderCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                    CommandParameter="{Binding}" />
                                            </CheckBox.InputBindings>
                                        </CheckBox>

                                        <!-- Nom du personnage -->
                                        <TextBlock Grid.Column="1" Text="{Binding DisplayName}"
                                                   VerticalAlignment="Center" Margin="8,0,0,0"
                                                   TextTrimming="CharacterEllipsis" />

                                        <!-- Raccourci (capture clavier) -->
                                        <controls:HotkeyCaptureBox Grid.Column="2"
                                            HotkeyModifiers="{Binding HotkeyModifiers, Mode=TwoWay}"
                                            VirtualKeyCode="{Binding VirtualKeyCode, Mode=TwoWay}"
                                            HotkeyDisplay="{Binding HotkeyDisplay, Mode=TwoWay}"
                                            VerticalContentAlignment="Center"
                                            Margin="4,0,0,0" />
                                    </Grid>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </StackPanel>
                </GroupBox>

                <!-- ===== RACCOURCIS GLOBAUX ===== -->
                <GroupBox Header="Raccourcis globaux" Margin="0,0,0,8">
                    <ItemsControl ItemsSource="{Binding GlobalHotkeys}" Margin="5">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Grid Margin="0,2">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="160" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Column="0" Text="{Binding Label}"
                                               VerticalAlignment="Center" />
                                    <controls:HotkeyCaptureBox Grid.Column="1"
                                        HotkeyModifiers="{Binding HotkeyModifiers, Mode=TwoWay}"
                                        VirtualKeyCode="{Binding VirtualKeyCode, Mode=TwoWay}"
                                        HotkeyDisplay="{Binding HotkeyDisplay, Mode=TwoWay}"
                                        VerticalContentAlignment="Center" MaxWidth="200"
                                        HorizontalAlignment="Left" />
                                </Grid>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </GroupBox>

                <!-- ===== GROUPE ===== -->
                <GroupBox Header="Groupe" Margin="0,0,0,8" Padding="5">
                    <StackPanel Orientation="Horizontal">
                        <Button Content="Inviter tout le monde"
                                Command="{Binding InviteAllCommand}" Padding="8,3" />
                        <Button Content="Toggle Autofollow"
                                Command="{Binding ToggleAutoFollowCommand}" Padding="8,3" Margin="8,0,0,0" />
                        <TextBlock VerticalAlignment="Center" Margin="10,0,0,0"
                                   Text="/invite depuis le leader. Ctrl+W sur chaque suiveur." Foreground="Gray" />
                    </StackPanel>
                </GroupBox>

                <!-- ===== PUSH-TO-BROADCAST ===== -->
                <GroupBox Header="Push-to-Broadcast" Margin="0,0,0,8" Padding="5">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <Button Grid.Column="0"
                                Content="{Binding PushToBroadcastButtonText}"
                                Command="{Binding TogglePushToBroadcastCommand}"
                                Padding="8,3" Margin="0,0,8,0" />

                        <Border Grid.Column="1" CornerRadius="3" Padding="8,3">
                            <Border.Style>
                                <Style TargetType="Border">
                                    <Setter Property="Background" Value="Gray" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsArmed}" Value="True">
                                            <Setter Property="Background" Value="#E74C3C" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>
                            <TextBlock Text="{Binding PushToBroadcastIndicator}"
                                       FontWeight="Bold" Foreground="White" />
                        </Border>

                        <TextBlock Grid.Column="2" VerticalAlignment="Center" Margin="10,0,0,0"
                                   Foreground="Gray" TextWrapping="Wrap"
                                   Text="Maintenez Alt : chaque clic est broadcasté." />
                    </Grid>
                </GroupBox>

                <!-- ===== PROFIL ===== -->
                <GroupBox Header="Profil" Margin="0,0,0,8" Padding="5">
                    <WrapPanel Orientation="Horizontal">
                        <!-- Sélection profil -->
                        <ComboBox ItemsSource="{Binding Profiles}"
                                  SelectedItem="{Binding SelectedProfile}"
                                  DisplayMemberPath="ProfileName"
                                  Width="160" Margin="0,0,5,3" />
                        <Button Content="Charger"
                                Command="{Binding LoadProfileCommand}"
                                Padding="8,3" Margin="0,0,5,3" />
                        <Button Content="Sauvegarder"
                                Command="{Binding SaveProfileCommand}"
                                Padding="8,3" Margin="0,0,5,3" />
                        <Button Content="Supprimer"
                                Command="{Binding DeleteProfileCommand}"
                                Padding="8,3" Margin="0,0,15,3" />

                        <!-- Nouveau profil -->
                        <TextBox Text="{Binding NewProfileName, UpdateSourceTrigger=PropertyChanged}"
                                 Width="140" VerticalContentAlignment="Center" Margin="0,0,5,3" />
                        <Button Content="Créer"
                                Command="{Binding CreateProfileCommand}"
                                Padding="8,3" Margin="0,0,15,3" />

                        <!-- Reset -->
                        <Button Content="Réinitialiser raccourcis"
                                Command="{Binding ResetDefaultsCommand}"
                                Padding="8,3" Margin="0,0,0,3" />
                    </WrapPanel>
                </GroupBox>
            </StackPanel>
        </ScrollViewer>
    </DockPanel>
</Window>
